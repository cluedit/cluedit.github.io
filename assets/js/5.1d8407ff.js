(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{168:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"to-유찬형"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#to-유찬형","aria-hidden":"true"}},[t._v("#")]),t._v(" to 유찬형")]),t._v(" "),n("p",[t._v(".gitlab-ci.yml을 프로젝트 루트 경로에 넣어주시면 됩니다 ㅋㅋ\n아래는 파일 내용이에요")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .gitlab-ci.yml")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 일단 php용 도커 이미지를 선택하고요.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tetraweb/php\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 실제 스크립트를 실행하기 전에 사전준비를 해요.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("before_script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 이건 뭐 아실테고 ㅋㅋㅋ")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("get update\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 이것도 잘 알고 계시죠!")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("get install zip unzip\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 이거는 이제 컴포져 설치!")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" php "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("r \"copy('https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//getcomposer.org/installer'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'composer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("setup.php');\"\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" php composer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("setup.php\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" php "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("r \"unlink('composer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("setup.php');\"\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 그리고 디펜던시 설치")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" php composer.phar install\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 그리고 vendor 같은 경우에는 pipeline에서 설치하면서 만들어낼 수 있으니까, git repo내에 포함시킬 필요는 없을거같아요!")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssh 준비!")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p ~/.ssh\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" eval $(ssh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("s)\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[[ -f /.dockerenv ]] && echo -e \"Host *\\n\\tStrictHostKeyChecking no\\n\\n\" > ~/.ssh/config'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pipeline에 들어갈 job 이름이에요.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy-to-server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 이거는 이제, 여기 보시면 빠르실거에요!")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# https://docs.gitlab.com/ee/user/project/pipelines/job_artifacts.html")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("artifacts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build/\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 마스터 브랜치에 푸시가 들어오는 경우로 제한하는거에요.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 여기서부터 이제 실제 스크립트")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssh key 넣어주구요")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ssh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('add <(echo "$STAGING_PRIVATE_KEY")\n    '),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssh 붙은 다음 임시 디렉토리 하나 만들어줍니다!")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ssh "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('p22 server_user@server_host "mkdir /임시/디렉토리"\n    '),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 요 커맨드가 이제 ssh를 이용해서, 파일을 이동하는 커맨드!")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 임시 디렉토리에 저장했다가, 라이브 파일들을 또다른 임시 디렉토리로 옮기고 임시 디렉토리에 올려놓은 새버전을")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 라이브 경로에 옮겨놓습니다. 그리고 이전 버전은 삭제하시면 끝이에요!")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" scp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("P22 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("r 옮길파일경로 server_user@server_host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/임시/디렉토리\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ssh "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('p22 server_user@server_host "mv /현재/live /현재/live/임시 && mv /임시/디렉토리 /현재/live"\n    '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ssh "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('p22 server_user@server_host "rm '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('rf /현재/live/임시"\n')])])])])}],!1,null,null,null);s.default=e.exports}}]);